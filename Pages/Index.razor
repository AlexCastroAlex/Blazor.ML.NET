@page "/"
@using Microsoft.ML.Data;

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?" />

<InputText @bind-Value="imagePath"></InputText>
<button onclick="@ObjectDetectionImage">Object Detection</button>

@if(!string.IsNullOrEmpty(returnImage) )
{
    <img src="@returnImage" />
}

@code {
    private string imagePath = string.Empty;
    private string returnImage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        imagePath = "https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png";
    }

    private async Task ObjectDetectionImage()
    {
        //Load sample data
        var image = MLImage.CreateFromFile(@"C:\Users\alexandre.castro\Downloads\object-detection-assets\Stop-Signs\joshua-hoehne-WPrTKRw8KRQ-unsplash.jpg");
        MLModel.ModelInput sampleData = new MLModel.ModelInput()
            {
                Image = image,
            };

        //Load model and predict output
        var result = MLModel.Predict(sampleData);
        MemoryStream stream = new MemoryStream();
        stream.Write(result.Image.GetBGRPixels, 0, result.Image.Pixels.Length);

        //var resultimg = MLImage.CreateFromPixels(result.Image.Width, result.Image.Height, MLPixelFormat.Bgra32, result.Image.Pixels);
        var imagesrc = Convert.ToBase64String(result.Image.Pixels);
        returnImage = string.Format("data:image/jpg;base64,{0}", imagesrc);

    }

}
